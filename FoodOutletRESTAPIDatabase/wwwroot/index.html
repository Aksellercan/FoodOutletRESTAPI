<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Outlets</title>
</head>
<body>
    <h1>Food Outlets</h1>
    <div id="foodOutletsContainer">
        <!-- Food outlets will be listed here -->
    </div>

    <h2>Add a Review</h2>
    <form id="reviewForm">
        <label for="foodOutletId">Food Outlet ID:</label>
        <input type="number" id="foodOutletId" name="foodOutletId" required><br><br>

        <label for="comment">Comment:</label>
        <textarea id="comment" name="comment" required></textarea><br><br>

        <label for="score">Score (1-5):</label>
        <input type="number" id="score" name="score" min="1" max="5" required><br><br>

        <button type="submit">Submit Review</button>
    </form>

    <script>
        // Function to fetch food outlets and display them
        async function fetchFoodOutlets() {
            try {
                const response = await fetch('http://localhost:7277/api/foodoutlets');
                const data = await response.json();
                renderFoodOutlets(data);
            } catch (error) {
                console.error('Error fetching food outlets:', error);
            }
        }

        // Function to render the list of food outlets
        function renderFoodOutlets(outlets) {
            const container = document.getElementById('foodOutletsContainer');
            container.innerHTML = ''; // Clear any previous content

            if (outlets.length === 0) {
                container.innerHTML = '<p>No food outlets available.</p>';
            } else {
                outlets.forEach(outlet => {
                    const outletDiv = document.createElement('div');
                    outletDiv.innerHTML = `
                            <h3>${outlet.name}</h3>
                            <p><strong>Location:</strong> ${outlet.location}</p>
                            <p><strong>Rating:</strong> ${outlet.rating}</p>
                            <p><strong>Review Count:</strong> ${outlet.reviewCount}</p>
                        `;
                    container.appendChild(outletDiv);
                });
            }
        }

        // Function to submit a review
        async function submitReview(event) {
            event.preventDefault();

            const foodOutletId = document.getElementById('foodOutletId').value;
            const comment = document.getElementById('comment').value;
            const score = document.getElementById('score').value;

            const review = {
                foodOutletId: parseInt(foodOutletId),
                comment: comment,
                score: parseInt(score)
            };

            try {
                const response = await fetch('http://localhost:7277/foodoutlets/' + foodOutletId + '/reviews', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(review)
                });

                if (response.ok) {
                    alert('Review submitted successfully!');
                    fetchFoodOutlets(); // Refresh the food outlets list
                } else {
                    const errorData = await response.json();
                    alert('Error submitting review: ' + errorData.title);
                }
            } catch (error) {
                console.error('Error submitting review:', error);
            }
        }

        // Add event listener for the form submit
        document.getElementById('reviewForm').addEventListener('submit', submitReview);

        // Fetch food outlets on page load
        fetchFoodOutlets();
    </script>
</body>
</html>
